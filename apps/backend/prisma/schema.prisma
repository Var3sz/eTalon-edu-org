generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Course {
  id                Int                  @id @default(autoincrement())
  courseId          String               @unique @db.VarChar
  description       String               @db.VarChar
  active            Boolean              @default(true)
  endTime           String               @db.VarChar
  groupId           Int
  headcount         Int?
  locationId        Int
  startDate         DateTime             @db.Timestamp(6)
  startTime         String               @db.VarChar
  locked            Boolean              @default(false)
  maxHeadCount      Int
  group             Group                @relation(fields: [groupId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  location          Location             @relation(fields: [locationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  CouseInvoiceDates CourseInvoiceDates[]
  CourseLessonDates CourseLessonDates[]
  Course_Package    Course_Package[]
  Participant       Participant[]
}

model Student {
  id                   Int                 @id @default(autoincrement())
  email                String              @db.VarChar
  lastname             String              @db.VarChar
  firstname            String              @db.VarChar
  billCompany          String?             @db.VarChar
  city                 String?             @db.VarChar
  zip                  Int?
  address              String?             @db.VarChar
  mobile               String?             @db.VarChar
  billingAddressTypeId Int?
  childGrade           Int?
  childMail            String?             @db.VarChar
  childName            String              @db.VarChar
  childTAJ             String?             @db.VarChar
  coupon               String?             @db.VarChar
  discount             String?             @db.VarChar
  discount2            String?             @db.VarChar
  disease              Boolean?            @default(false)
  diseaseDesc          String?             @db.VarChar
  packageCode          String              @db.VarChar
  packageType          String              @db.VarChar
  sapId                Int                 @unique
  specialDiet          Boolean?            @default(false)
  specialDietDesc      String?             @db.VarChar
  subdate              DateTime            @db.Timestamp(6)
  vatNum               String?             @db.VarChar
  attendance           Attendance[]
  Participant          Participant[]
  Payment              Payment[]
  BillingAddressType   BillingAddressType? @relation(fields: [billingAddressTypeId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Attendance {
  id           Int          @id @default(autoincrement())
  studentId    Int?
  attended     Boolean?     @default(false)
  lessondateId Int?
  LessonDates  LessonDates? @relation(fields: [lessondateId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student      Student?     @relation(fields: [studentId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([studentId, lessondateId], map: "attendance_student_lesson_unique")
}

model Group {
  id          Int       @id @default(autoincrement())
  description String    @unique @db.VarChar
  isDeleted   String?   @db.Char
  courses     Course[]
  Package     Package[]
}

model Location {
  id          Int       @id @default(autoincrement())
  description String    @unique @db.VarChar
  isDeleted   String?   @db.Char
  courses     Course[]
  Package     Package[]
}

model User {
  id            Int       @id @default(autoincrement())
  email         String    @unique @db.VarChar
  name          String    @db.VarChar
  password      String    @db.VarChar
  roleId        Int
  agentKey      String?   @db.VarChar
  sessionCookie String?   @db.VarChar
  Payments      Payment[]
  role          Role      @relation(fields: [roleId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Role {
  id    Int     @id @default(autoincrement())
  name  String? @unique @db.VarChar
  users User[]
}

model BillingAddressType {
  id          Int       @id @default(autoincrement())
  description String    @db.VarChar
  Student     Student[]
}

model CourseLessonDates {
  id           Int          @id @default(autoincrement())
  courseId     Int?
  lessondateId Int?
  Course       Course?      @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  LessonDates  LessonDates? @relation(fields: [lessondateId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Course_Package {
  id        Int     @id @default(autoincrement())
  packageId String  @db.VarChar
  courseId  Int
  Course    Course  @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Package   Package @relation(fields: [packageId], references: [packageId], onDelete: NoAction, onUpdate: NoAction)

  @@unique([packageId, courseId], map: "course_package_unique")
  @@index([courseId], map: "idx_course_package_course_id")
  @@index([packageId], map: "idx_course_package_package_id")
}

model LessonDates {
  id                Int                 @id @default(autoincrement())
  date              DateTime            @db.Timestamp(6)
  description       String?             @db.VarChar
  Attendance        Attendance[]
  CourseLessonDates CourseLessonDates[]
}

model Package {
  id             Int              @id @default(autoincrement())
  packageId      String           @unique @db.VarChar
  price          Int
  type           String           @db.VarChar
  locationId     Int
  active         Boolean
  groupId        Int
  Course_Package Course_Package[]
  Group          Group            @relation(fields: [groupId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Location       Location         @relation(fields: [locationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Participant {
  id        Int     @id @default(autoincrement())
  courseId  Int
  studentId Int
  Course    Course  @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Student   Student @relation(fields: [studentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model InvoiceDates {
  id                 Int                  @id @default(autoincrement())
  date               DateTime             @db.Timestamp(6)
  description        String?              @db.VarChar
  CourseInvoiceDates CourseInvoiceDates[]
  Payment            Payment[]
}

model CourseInvoiceDates {
  id            Int           @id @default(autoincrement())
  courseId      Int?
  invoiceDateid Int?
  Course        Course?       @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  InvoiceDates  InvoiceDates? @relation(fields: [invoiceDateid], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Payment {
  id              Int          @id @default(autoincrement())
  invoiceDateId   Int
  studentId       Int
  billerId        Int?
  payed           Boolean?
  amount          Int?
  invoiceNumber   String?      @db.VarChar
  amountToBePayed Int?
  User            User?        @relation(fields: [billerId], references: [id], onDelete: Restrict)
  InvoiceDates    InvoiceDates @relation(fields: [invoiceDateId], references: [id])
  Students        Student      @relation(fields: [studentId], references: [id])

  @@unique([studentId, invoiceDateId], map: "studentId_invoiceDateId_unique")
}

view ActiveCoursesView {
  id                  Int       @unique
  courseId            String?   @db.VarChar
  groupDescription    String?   @db.VarChar
  locationDescription String?   @db.VarChar
  occupancy           Int?
  price               String?
  headcount           Int?
  maxHeadCount        Int?
  description         String?
  locked              Boolean?
  startDate           DateTime? @db.Timestamp(6)
  startTime           String?   @db.VarChar
  endTime             String?   @db.VarChar
  active              Boolean?
}
