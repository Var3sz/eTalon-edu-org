generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Course {
  id                Int                 @id @default(autoincrement())
  courseId          String              @unique @db.VarChar
  description       String              @db.VarChar
  startDate         DateTime            @db.Timestamp(6)
  startTime         String              @db.VarChar
  endTime           String              @db.VarChar
  headcount         Int?
  maxHeadCount      Int
  active            Boolean             @default(true)
  locked            Boolean             @default(false)
  groupId           Int
  locationId        Int
  group             Group               @relation(fields: [groupId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  location          Location            @relation(fields: [locationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  CourseLessonDates CourseLessonDates[]
  Course_Package    Course_Package[]
  Participant       Participant[]
}

model Student {
  id                   Int                 @id @default(autoincrement())
  sapId                Int                 @unique
  subdate              DateTime            @db.Timestamp(6)
  email                String              @db.VarChar
  firstname            String              @db.VarChar
  lastname             String              @db.VarChar
  billCompany          String?             @db.VarChar
  city                 String?             @db.VarChar
  zip                  Int?
  address              String?             @db.VarChar
  coupon               String?             @db.VarChar
  vatNum               String?             @db.VarChar
  billingAddressTypeId Int?
  childName            String              @db.VarChar
  childMail            String?             @db.VarChar
  childGrade           Int?
  childTAJ             String?             @db.VarChar
  specialDiet          Boolean?            @default(false)
  specialDietDesc      String?             @db.VarChar
  mobile               String?             @db.VarChar
  packageType          String              @db.VarChar
  packageCode          String              @db.VarChar
  disease              Boolean?            @default(false)
  diseaseDesc          String?             @db.VarChar
  discount             String?             @db.VarChar
  discount2            String?             @db.VarChar
  attendance           Attendance[]
  Participant          Participant[]
  BillingAddressType   BillingAddressType? @relation(fields: [billingAddressTypeId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Attendance {
  id           Int          @id @default(autoincrement())
  lessondateId Int?
  studentId    Int?
  attended     Boolean?     @default(false)
  LessonDates  LessonDates? @relation(fields: [lessondateId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student      Student?     @relation(fields: [studentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Group {
  id          Int      @id @default(autoincrement())
  description String   @unique @db.VarChar
  courses     Course[]
}

model Location {
  id          Int      @id @default(autoincrement())
  description String   @unique @db.VarChar
  courses     Course[]
}

model User {
  id       Int    @id @default(autoincrement())
  name     String @db.VarChar
  email    String @unique @db.VarChar
  password String @db.VarChar
  roleId   Int
  role     Role   @relation(fields: [roleId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Role {
  id    Int     @id @default(autoincrement())
  name  String? @unique @db.VarChar
  users User[]
}

model BillingAddressType {
  id          Int       @id @default(autoincrement())
  description String    @db.VarChar
  Student     Student[]
}

model CourseLessonDates {
  id           Int          @id @default(autoincrement())
  courseId     Int?
  lessondateId Int?
  Course       Course?      @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  LessonDates  LessonDates? @relation(fields: [lessondateId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Course_Package {
  id        Int     @id @default(autoincrement())
  packageId String  @db.VarChar
  courseId  Int
  Course    Course  @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Package   Package @relation(fields: [packageId], references: [packageId], onDelete: NoAction, onUpdate: NoAction)
}

model LessonDates {
  id                Int                 @id @default(autoincrement())
  date              DateTime            @db.Timestamp(6)
  description       String?             @db.VarChar
  Attendance        Attendance[]
  CourseLessonDates CourseLessonDates[]
}

model Package {
  id             Int              @id @default(autoincrement())
  packageId      String           @unique @db.VarChar
  price          Int
  Course_Package Course_Package[]
}

model Participant {
  id        Int     @id @default(autoincrement())
  courseId  Int
  studentId Int
  Course    Course  @relation(fields: [courseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Student   Student @relation(fields: [studentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

view ActiveCoursesView {
  id               Int       @unique
  courseId         String?   @db.VarChar
  groupDescription String?   @db.VarChar
  occupancy        Int?
  description      String?
  headcount        Int?
  maxHeadCount     Int?
  price            Int?
  startDate        DateTime? @db.Timestamp(6)
  startTime        String?   @db.VarChar
  endTime          String?   @db.VarChar
  active           Boolean?
  locked           Boolean?
}
