generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Course {
  id           Int                 @id @default(autoincrement())
  courseId     String
  description  String
  price        Int?
  active       Boolean             @default(false)
  endTime      String
  groupId      Int
  headcount    Int?                @default(0)
  locationId   Int
  maxHeadcount Int
  startDate    DateTime
  startTime    String
  locked       Boolean             @default(false)
  group        Group               @relation(fields: [groupId], references: [id])
  location     Location            @relation(fields: [locationId], references: [id])
  courseDates  Course_CourseDate[]
  students     Course_Students[]
}

model CourseDates {
  id          Int                 @id @default(autoincrement())
  date        DateTime
  description String
  attendance  Attendance[]
  courses     Course_CourseDate[]
}

model Student {
  id            Int               @id @default(autoincrement())
  email         String
  lastname      String
  firstname     String
  billCompany   String?
  city          String
  zip           Int
  address       String
  vatNumber     String?
  children      String
  childrenMail  String?
  mobile        String
  billingTypeId Int
  attendance    Attendance[]
  courses       Course_Students[]
  billingType   BillingType       @relation(fields: [billingTypeId], references: [id])
}

model Course_CourseDate {
  id           Int         @id @default(autoincrement())
  courseId     Int
  courseDateId Int
  courseDate   CourseDates @relation(fields: [courseDateId], references: [id])
  course       Course      @relation(fields: [courseId], references: [id])
}

model Course_Students {
  id        Int     @id @default(autoincrement())
  courseId  Int
  studentId Int
  course    Course  @relation(fields: [courseId], references: [id])
  student   Student @relation(fields: [studentId], references: [id])
}

model Attendance {
  id           Int         @id @default(autoincrement())
  courseDateId Int
  studentId    Int
  attended     Boolean
  courseDate   CourseDates @relation(fields: [courseDateId], references: [id])
  student      Student     @relation(fields: [studentId], references: [id])
}

model Group {
  id          Int      @id @default(autoincrement())
  description String
  courses     Course[]
}

model Location {
  id          Int      @id @default(autoincrement())
  description String
  courses     Course[]
}

model BillingType {
  id          Int       @id @default(autoincrement())
  description String
  students    Student[]
}

view CourseSummaryView {
  id               Int       @unique
  courseId         String?
  groupDescription String?
  occupancy        Int?
  description      String?
  headcount        Int?
  maxHeadcount     Int?
  price            Int?
  startDate        DateTime?
  startTime        String?
  endTime          String?
  active           Boolean?
  locked           Boolean?
}
